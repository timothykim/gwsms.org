<% if @error %>
	<%= @error %>
<% else %>


<% form_tag "/register/save", :method => "post" , :id => "register_form" do -%>
<%= hidden_field_tag "session_id", @current_session.id %>

<h2>Registering for <%= @current_session %></h2>

<hr />

<h3>Parent Information</h3>

<div class="form_box" id="parent_info">
  <%= hidden_field "parent", "id" %>
  <div class="form_element">
    <label class="form_label">First Name:</label>
    <%= text_field :parent, :firstname, :class => "text", :size => 20 %>
  </div>

  <div class="form_element">
    <label class="form_label">Last Name:</label>
    <%= text_field :parent, :lastname, :class => "text", :size => 20 %>
  </div>

  <div class="form_element">
    <label class="form_label">Login E-mail:</label>
    <%= text_field :parent, :email, :class => "text", :size => 30 %>
    <div class="form_info">
      Please make sure that this e-mail is your primary e-mail that you daily check. This e-mail is what you will use to login to this website.
    </div>
  </div>

  <div class="form_element">
    <label class="form_label">Alternate E-mail:</label>
    <%= text_field :parent, :alternate_email, :class => "text", :size => 30 %>
    <div class="form_info">
      In the case where above e-mail does not work, please provide an alternative e-mail. i.e. Your spouse's e-mail.
    </div>
  </div>

  <div class="form_element">
    <label class="form_label">Mailing Address:</label>
    <%= text_area :parent, :address, :class => "text", :size => "30x2" %>
  </div>

  <div class="form_element">
    <label class="form_label">Home Phone:</label>
    <%= text_field :parent, :home_phone, :class => "text", :size => 20 %>
  </div>
  <div class="form_element">
    <label class="form_label">Work Phone:</label>
    <%= text_field :parent, :work_phone, :class => "text", :size => 20 %>
  </div>
  <div class="form_element">
    <label class="form_label">Mobile Phone:</label>
    <%= text_field :parent, :mobile_phone, :class => "text", :size => 20 %>
  </div>
</div>

<hr />

<h3>Student Information</h3>

<div class="form_box" id="student_info">
	<div class="form_element">
	<label class="form_label">Student:</label>
	<div class="student_name">
		<% if @student.id.nil? %>
			New Student <input type="hidden" name="new" value="true" />
		<% else %>
			<%= @student %> <%= hidden_field "student", "id" %>
		<% end %>
	</div>
	</div>

	<div class="form_element">
	<label class="form_label">First Name:</label> <%= text_field "student", "first_name", :class => "text", :size => 20 %>
	</div>

	<div class="form_element">
	<label class="form_label">Middle Initial:</label> <%= text_field "student", "middle_initial", :class => "text", :size => 2, :maxlength => 1 %>
	</div>

	<div class="form_element">
	<label class="form_label">Last Name:</label> <%= text_field "student", "last_name", :class => "text", :size => 20 %>
	</div>

	<div class="form_element">
	<label class="form_label">Date of Birth:</label> <%= date_select("student", "dob", :start_year => Time.now.year - 30, :end_year => Time.now.year - 2, :default => {:year => Time.now.year - 10, :month => 1, :day => 1}, :order => [:month, :day, :year]) %>
	</div>

	<div class="form_element">
	<label class="form_label">Attending School:</label> <%= text_field "student", "school", :class => "text", :size => 20 %>
	</div>

	<div class="form_element">
	<label class="form_label">Grade Level: </label> <%= text_field "student", "grade_level", :class => "text number", :size => 10 %> <%= "on Fall of #{@year}" if @season == "Summer"%>
	</div>

	<div class="form_element">
	<label class="form_label">Comments:<br /><small>(Any information that teacher should know about the student)</small></label> <%= text_area "student", "comment", :class => "text", :size => "45x3" %>
	</div>
</div>

<hr />


<h3>Registration Information</h3>

<div id="notice">
	<%= textilize(@current_session.registration_notes) %>
</div>

<div class="form_box" id="reg">
	
	<div class="form_element">
		<label class="form_label">This registration is for:</label>
        <%= select "registration", "school_id", School.find(:all, :order => "id", :limit => 2).collect {|s| [s.name, s.id] } %>
	</div>

	<div class="form_element">
		<label class="form_label">Single Lesson Duration:</label>
		<%= text_field "registration", "lesson_duration", :class=>"text", :style=>"text-align:right;", :size=>3, :maxlength=>3 %> minutes
	</div>
	
	
	<% @registration_options.each do |option| -%>
	<div class="form_element">
<%
o = @registration.registered_options.find(:first, :conditions => {:option_id => option.id})
value = ""
value = o.value if o
%>
<%=
case option.input_type
	when "text"
		'<label class="form_label">' + option.text + '</label>' + text_field_tag("reg_option[#{option.id}]", value.to_s, :class => "text", :size => 20)

	when "big_text"
		'<label class="form_label">' + option.text + '</label>' + text_area_tag("reg_option[#{option.id}]", value.to_s, :class => "text", :size => "30x3")

	when "checkbox"
		'<label class="form_label">' + option.text + '</label>' + radio_button_tag("reg_option[#{option.id}]", "yes", value == "yes") + " Yes<br />" + radio_button_tag("reg_option[#{option.id}]", "no" , value == "no") + " No"

end -%>
	</div>
	
	<% end -%>
</div>

<hr />

<h3>Scheduling</h3>

<% if @current_session.registration_type == Session::DATE_TYPE %>
	<div id="calendar">
		<h4>Individual Lessons</h4>
		<ul>
			<li>Please indicate ALL possible time RANGE for EACH DAY.<br /><em>e.g: 6-8pm, 10am~1:30pm</em></li>
			<li>Please write down <strong>pm</strong> or <strong>am</strong> with your times.<br /><em>e.g: 8~9am, 2~4pm but NOT 7~8</em></li>
			<li>Multiple range can be entered per day by putting them on <strong>separate lines</strong>.</li>
			<li>You may mark a time range with an * (asterisk) to indicate preferred time.<br /><em>e.g: 4-5pm*, *1-3:30pm</em></li>
		</ul>
		<div class="help">
		<p>Example:</p>
		<table width="110" height="100"><thead><tr><th>Tuesday</th></tr></thead><tr><td class="cell"><div class="date">MM/DD</div><div class="notes"><br /></div><textarea class="text time_range" id="sample" readonly="readonly">7-10am,
11am~3:30pm,
6-7pm*</textarea></td></tr></table>

		<p>Legend:</p>
		<table width="110" height="100"><thead><tr><th>Off Day</th></tr></thead><tr><td valign="top" class="cell off_day"><div class="date">MM/DD</div><div class="notes"><br /></div></td></tr></table>

		</div>
		
        <% other_students = @parent.students.find_all{|s| s.id != @student.id and s.registered?(@current_session)} %>
        <% if other_students.length > 0 %>
			<div style="color: #77c;">
			Copy Schedule from: <select onchange="updateCalendar(this.value);"><option value="0">Select a student</option>
			<% other_students.each do |s|%>
              <option value="<%= s.get_registration(@current_session).id %>"> - <%= s %></option>
			<% end %>
			</select>
			</div>
		<% end %>
		
		
		<table>
			<thead>
				<tr>
					<th>W</th>
					<th>Monday</th>
					<th>Tuesday</th>
					<th>Wednesday</th>
					<th>Thursday</th>
					<th>Friday</th>
					<th>Saturday</th>
				</tr>
			</thead>
			<tbody>
<%		@dates.each_with_index do |today, i| -%>
<%			if i % 6 == 0 #index % 6 does NOT corespond to day of the week -%>
				<tr>
					<td class="week_no"><%= i / 6  %></td>
<%			end #if -%>
<%			clss = "" -%>
<%			clas = (today.date.mon % 2 == 1) ? "odd_month" : "even_month" -%>
<%			clas = " off_day" if today.offday -%>
<%			form = text_area_tag("times[#{today.date.strftime("%Y/%m/%d")}]", "", :class=>"text time_range", :id=>today.date.to_s) unless today.offday -%>
<%#			grpd = "<div class=\"group_day\"><input class=\"group_box\" type=\"checkbox\" id=\"#{today.date.to_s}\" name=\"groups[#{today.date.strftime("%Y/%m/%d")}]\"><label for=\"#{today.date.to_s}\"> Group Class</label></div>" if today.group -%>
<%			grpd = (today.group) ? "<div class=\"group_day\">Group Class</div>" : "<div class=\"group_day\"><br /></div>"  -%>

					<td valign="top" class="cell <%= clas %>"><div class="date"><%= today.date.strftime("%m/%d") %></div><div class="notes"><%= today.note %><br /></div><div class="time_range_form"><%= form %></div><%= grpd %></td>
<%			if i % 6 == 5 -%>
				</tr>
<%			end #if -%>
<%		end #each -%>
			</tbody>
		</table>
		
	</div>
	
<% else #if @current_session.registration_type == Session::DAY_TYPE %>


  <ul>
    <li>On the calendar below, by clicking and dragging, highlight ALL available lesson time frames.</li>
    <li>To get rid of a selected time frame, just double click on the red box.</li>
    <li>Earliest possible lesson time is 7:00AM</li>
    <li>Preferred lessons times are mornings and early afternoon. So if possible, please register for those times. As for early afternoon times, if your child's school has an early release day, then please utilize that and reigster for early afternoons.</li>
    <li><span style="background-color: #cfc">Green time slots</span> are for CHMS students only.</li>
    <li><a href="#" onclick="$('tutorial').show(); return false;">View the tutorial video</a>
  </ul>

<div id="tutorial" style="display: none;">
  <big><a href="#" onclick="$('tutorial').hide(); return false;" style="color: white;">Close this video</a></big><br /><br />
<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/MXJEn1w0Ee0&hl=en&fs=1&rel=0"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/MXJEn1w0Ee0&hl=en&fs=1&rel=0" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>
</div>
    <table class="default_table selection_table">
      <thead>
          <tr>
              <th>T</th>
              <th width="20%">Monday</th>
              <th width="20%">Tuesday</th>
              <th width="20%">Wednesday</th>
              <th width="20%">Thursday</th>
              <th width="20%">Friday</th>
          </tr>
      </thead>
      <tbody>
          <tr>
            <td valign="top">
              <% for i in (7..19) %>
              <% 
                t = (i > 11) ? "#{i-12}pm" : "#{i}am"
                t = "12pm" if i == 12
              %>
                <div style="border-top: 1px solid silver; height: 31px; text-align:right; font-size:10px; background-color:rgb(232, 238, 247);"><%=t%></div>
              <% end %>
                <div style="border-top: 1px solid silver; height: 15px; text-align:right; font-size:10px; background-color:rgb(232, 238, 247);">8pm</div>
            </td>
            <% 5.times do |d| %>
              <td valign="top">

                <% for i in (7..19) %>
                  <% bg = (i >= 5 && i < 12 && d == 2) ? "#cfc" : "" %>


                  <% h = (i.to_s.length == 1) ? "0#{i}" : i.to_s %>
                  <% id_1 = "d#{d}_#{h}:00" %>
                  <% id_2 = "d#{d}_#{h}:30" %>
                  <% cls = (@r_days.index(id_1)) ? "selected" : "" %>
                  <div class="calendar_div selection_<%=d%> <%=cls%>" id="<%=id_1%>" style="background-color: <%=bg%>; padding:0px; margin:0px; border-top: 1px solid silver; height: 15px; font-size: 9px;" onmouseup="click_end();" onmousedown="click_start(this, <%=d%>)" onmouseover="high_light(this, <%=d%>);" ondblclick="dehighlight(this)"></div>
                  <% cls = (@r_days.index(id_2)) ? "selected" : "" %>
                  <div class="calendar_div selection_<%=d%> <%=cls%>" id="<%=id_2%>" style="background-color: <%=bg%>; padding:0px; margin:0px; border-top: 1px dotted silver; height: 15px; font-size: 9px;" onmouseup="click_end();" onmousedown="click_start(this, <%=d%>)" onmouseover="high_light(this, <%=d%>);" ondblclick="dehighlight(this);"></div>
                <% end %>
                <div class="selection_<%=d%>" id="d<%=d%>_20:00" style="background-color:silver; padding:0px; margin:0px; border-top: 1px solid silver; height: 15px; font-size: 9px;"></div>

              </td>
            <% end %>
          </tr>
      </tbody>
    </table>
    <%= hidden_field_tag "schedule_selection" %>
    
<% end %>

<hr />

<div>

		<h4>Group Classes</h4>
		<p><%= @current_session %> session will have group classes on following days.</p>
		<ol>
		<% @group_days.each do |g| %>
			<li><%= g.date.strftime("%m/%d/%Y - %A") %></li>
		<% end %>
		</ol>

</div>

<hr />
<h4>Tuition Information</h4>
<div id="tuition_2" class="tuition" style="display:none;">
    Your tuition will be billed soon. For more information, please contact Larry Claussen at lclaussen@columbiabaptist.org.
</div>

<div id="tuition_1" class="tuition" style="display:none;">
<table class="default_table">
  <thead>
    <tr>
      <th class="blank" rowspan="2">For HC Studio Parents</th>
      <th colspan="3">Individual Lesson Duration</th>
    </tr>
    <tr>
      <th class="silver">30 min.</th>
      <th class="silver">45 min.</th>
      <th class="silver">60 min.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Tuition Per Lesson</th>
      <td class="number">$37.50</td>
      <td class="number">$56.25</td>
      <td class="number">$75.00</td>
    </tr>
    <tr>
      <th>Tuition For 16 Lessons</th>
      <td class="number">$600.00</td>
      <td class="number">$900.00</td>
      <td class="number">$1,200.00</td>
    </tr>
    <tr>
      <th>Tuition For 15 Group Classes</th>
      <td colspan="3" class="center">$375.00</td>
    </tr>
    <tr>
      <th>Annual Registration Fee</th>
      <td colspan="3" class="center">$40.00</td>
    </tr>
    <tr>
      <th class="silver"><big>Total Tuition for returning parents</big></th>
      <td class="number big">$1,015.00</td>
      <td class="number big">$1,315.00</td>
      <td class="number big">$1,615.00</td>
    </tr>
    <tr>
      <th>Parent Education Class</th>
      <td colspan="3" class="center">$150.00</td>
    </tr>
    <tr>
      <th class="silver"><big>Total Tuition for new parents</big></th>
      <td class="number big">$1,165.00</td>
      <td class="number big">$1,465.00</td>
      <td class="number big">$1,765.00</td>
    </tr>
</table>
  <ul>
    <li>Please note that once your registration has been processed, you will receive an invoice for the tuition payment.</li>
  </ul>
</div>

<hr />
<h4>Photograph Agreement</h4>

<div class="agreement"> 
<input type="checkbox" name="photo_agreement"> By checking this box, 
I do NOT authorize the use and reproduction by the Suzuki Violin Program at Falls Church, or anyone authorized by the Suzuki Violin Program at Falls Church or its representatives of any or all photographs taken of the student registered on this form at Suzuki Violin Program premises or activities.
</div>


<h4>Policy Agreement</h4>
<div class="agreement"> 
<input type="checkbox" name="user_agreement" onclick="if(this.checked) { $('form_submit').removeAttribute('disabled'); } else { $('form_submit').setAttribute('disabled', 'disabled');}"/> By checking this box,
I hereby agree to abided by any and all policies of the Hannah Choi Suzuki Violin Program as stated in the Handbook, and I accept responsibility for all tuition and fees incurred.
</div>


<hr />


<div style="text-align: right; margin-top: 20px;">
<button class="iconbutton" disabled="disabled" id="form_submit" type="submit"><img src="/images/icons/write.png" class="icon"> Submit this Registration</button>
</div>



<% end #form %>


<% end #for error %>
