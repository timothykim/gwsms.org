<div id="side_list">
	<h3>Student List</h3>
	<p><small>Click on the name to see the lesson list</small></p>
	<ul>
	<% for student in @students %>
		<li>
			<table cellspacing="0" cellpadding="0" border="0"><tr><!--<td>
				<input type="checkbox" class="checkbox" id="st_check_<%= student.id %>" title="<%= student.id %>" onclick="return update_calendar(<%= student.id %>, this);" />
			</td>--><td>
				<label for="st_check_<%= student.id %>"><div class="studentname" style="background-color: #<%= @colors[student.id % 21] %>;" onclick="show_lesson_list(<%= student.id %>); return false;"><%= student.name %></div></label>
			</td><td width="20">
				<span id="lesson_count_<%= student.id %>"><a href="#" onclick="show_lesson_list(<%= student.id %>); return false;"><%= @schedules[student].size %></a></span>
				<div class="lesson_list" id="lesson_list_<%= student.id %>" style="display:none;">
					<div style="float:right;"><a href="#" onclick="close_lesson_list(<%= student.id %>); return false;">close</a></div>

					<strong><%= student.name %>'s Lessons</strong>
					<ul>
						<%= @student_lessons[student] %>
					</ul>
					
				</div>
			</td></table>
		</li>
	<% end %>
	</ul>
	<br />

	<h3>Jump to week</h3>
	<p>
	<% @numberofweeks.times do |week| %>
		<small><a href="#week<%= week %>"><%= week %></a></small>
	<% end %>
	</p>
</div>



<div id="calendar_table">
<table class="calendar main">
	<thead>
	<tr>
		<th width="30">Week</th>
		<th width="10">hrs</th>
		<th class="flex">Monday</th>
		<th class="flex">Tuesday</th>
		<th class="flex">Wednesday</th>
		<th class="flex">Thursday</th>
		<th class="flex">Friday</th>
	</tr>	
	</thead>
	<tbody>
<%
  @numberofweeks.times do |week|
%>
		<tr><td><a name="week<%= week %>"></a></td></tr>
		<tr>
			<th>
			<%= week %></th>
			<td  style="padding-top: 17px" valign="top">
				<% for i in (@day_start..@day_end)
						t = (i > 11) ? "#{i-12}pm" : "#{i}am"
						t = "12pm" if i == 12
				%>
					<div style="border-top: 1px solid silver; height: 31px; text-align:right; font-size:10px; background-color:rgb(232, 238, 247);"><%= t %></div>
				<% end %>
			</td>
<%
	for day in (1..5)
		today = @startdate + ((week * 7) + day)
		if @schedule[today.yday].nil?
			td_class = "not_active"
			active = false
		else
			td_class = "active"
			active = true
		end	
%>
		<td class="<%= td_class %>" valign="top">
			<div class="date"><%= today.strftime('%m/%d') %></div>
			<% for i in (@day_start..@day_end)
					bgcolor = ""

					for hours in @teaching_hours
						if active and i >= hours[day][0] and i < hours[day][1]
							bgcolor = "background-color: #{hours[:color]};"
						end
					end
										
					timestamp = Time.local(today.year, today.month, today.day, i).to_i
			%>
				<div id="t<%= timestamp %>" style="<%= bgcolor %> padding:0px; margin:0px; border-top: 1px solid silver; height: 15px;">
					<%
						if @all_lessons[timestamp]
					%>
					<div class="lesson_bar" style="margin-top: <%= @all_lessons[timestamp][:offset] %>px; height: <%= @all_lessons[timestamp][:duration] - 3 - 1 %>px; background-color: #<%= @colors[@all_lessons[timestamp][:student_id] % 21] %>"><span class="lesson_text"><%= @all_lessons[timestamp][:string] %></span></div>

					<% end %>
				
				</div>
			<%
					i += 0.5
					bgcolor = ""
					
					for hours in @teaching_hours
						if active and i >= hours[day][0] and i < hours[day][1]
							bgcolor = "background-color: #{hours[:color]};"
						end
					end

					timestamp = Time.local(today.year, today.month, today.day, i, 30).to_i
			%>
				<div id="t<%= timestamp %>" style="<%= bgcolor %> padding:0px; margin:0px;  border-top: 1px dotted silver; height: 15px; font-size:9px;">
				
					<%
						if @all_lessons[timestamp]
					%>
					<div class="lesson_bar" style="margin-top: <%= @all_lessons[timestamp][:offset] %>px; height: <%= @all_lessons[timestamp][:duration] - 3 - 1 %>px; background-color: #<%= @colors[@all_lessons[timestamp][:student_id] % 21] %>"><span class="lesson_text"><%= @all_lessons[timestamp][:string] %></span></div>

					<% end %>
				
					
				</div>
			<% end %>
		
		</td>
<% 
    end
%>
		</tr>
<% end %>
	</tbody>
</table>
</div>
